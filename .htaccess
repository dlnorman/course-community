# Course Community — Apache rewrite rules
# Enables clean URLs routed through index.php

RewriteEngine On

# Serve real files and directories directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Pass /api/* through to api.php
RewriteRule ^api/(.*)$ api.php/$1 [L,QSA]

# Pass /lti* through to lti.php
RewriteRule ^lti(.*)$ lti.php$1 [L,QSA]

# Everything else (including /auth/*, /join, /login) → index.php (SPA)
RewriteRule ^(.*)$ index.php [L,QSA]

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Protect sensitive files
<FilesMatch "^(config|config\.example|db)\.php$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect the data directory (database, uploads, logs)
<IfModule mod_authz_core.c>
    <DirectoryMatch "data/">
        Require all denied
    </DirectoryMatch>
</IfModule>
